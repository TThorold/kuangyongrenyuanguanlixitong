<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="../../css/css-content.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" media="all" href="./js/calendar-win2k-cold-1.css" title="win2k-cold-1">
    <script type="text/javascript" src="./js/calendar.js.下载"></script>
    <script type="text/javascript" src="./js/calendar-zh.js.下载"></script>
    <script type="text/javascript" src="./js/calendar-setup.js.下载"></script>
    <script type="text/javascript" src="./js/data.js"></script>

    <script>

        let data = []
        let arrowEnum = {
            'intoTime': [0, 'arrow1'],
            'outTime': [0, 'arrow2'],
            'shift': [0, 'arrow3'],
            'stayTime': [0, 'arrow4'],
        }

        // 按钮变色
        function offButton(e) {
            e.style.background = 'linear-gradient(to bottom , #8fb7e3, #537fa8, #8fb7e3)';
        }

        function onButton(e) {
            e.style.background = 'linear-gradient(to bottom , #fdfdad, #e0e01e, #fdfdad)';
        }

        // 箭头显示
        function changeArrow(id) {
            const e = document.getElementById(id)
            e.style.display = (e.style.display === 'inline' ? 'none' : 'inline');

        }

        // 数据升序
        function dataSort(str) {
            if (arrowEnum[str][0] === 0) {
                // 正序
                data.sort(
                    function (a, b) {
                        return toNum(a[str]) - toNum(b[str])
                    }
                )

                arrowEnum[str][0] = 1
                document.getElementById(arrowEnum[str][1]).innerText = '↑'

            } else {
                // 倒序
                data.sort(
                    function (a, b) {
                        return toNum(b[str]) - toNum(a[str])
                    }
                )

                arrowEnum[str][0] = 0
                document.getElementById(arrowEnum[str][1]).innerText = '↓'
            }

            clearTable()
            data.forEach(item => {
                addNodes(item)
            })
        }

        function toNum(num) {
            let str1;
            let str2;

            if (num.length > 7) {
                str1 = num.split(' ')
                str2 = str1[1].split(':')
            } else if (num.length === 5) {
                str2 = num.split(':')
            } else if (num.length === 3) {
                const numEnum = {
                    '零点班': 0,
                    '四点班': 4,
                    '八点班': 8,
                }

                return numEnum[num]
            }
            return (parseInt(str2[0]) * 60) + parseInt(str2[1])
        }

        function valid(obj) {
            if (!obj.date || !obj.timeFrame) {
                document.getElementById('rf1').style.display = 'block'
                return false
            } else {
                document.getElementById('rf1').style.display = 'none'
                return true
            }
        }

        function formatTime(str) {
            const arr = str.split(" ")
            return arr[0].split('/').map(Number)
        }

        function addNodes(obj) {
            const table = document.getElementById("dbGrid_People").getElementsByTagName('tbody')[0];
            let newRow = table.insertRow();
            // 创建三个新单元格
            let cellID = newRow.insertCell();
            let cellCardId = newRow.insertCell();
            let cellWorkId = newRow.insertCell();
            let cellName = newRow.insertCell();
            let cellDept = newRow.insertCell();
            let cellIntoTime = newRow.insertCell();
            let cellOutTime = newRow.insertCell();
            let cellShift = newRow.insertCell();
            let cellStayTime = newRow.insertCell();

            cellID.innerHTML = obj.id;
            cellCardId.innerHTML = obj.cardId;
            cellWorkId.innerHTML = obj.workId;
            cellName.innerHTML = obj.name;
            cellDept.innerHTML = obj.dept;
            cellIntoTime.innerHTML = obj.intoTime;
            cellOutTime.innerHTML = obj.outTime;
            cellShift.innerHTML = obj.shift;
            cellStayTime.innerHTML = obj.stayTime;
        }

        function clearTable() {
            const tbody = document.getElementById('dbGrid_People').getElementsByTagName('tbody')[0];
            // 直接清空 tbody 中的所有行
            tbody.innerHTML = '';
        }

        function getData() {
            clearTable()
            data = []

            const dept = document.getElementById("dpBMList").value;
            const name = document.getElementById("PeopleName").value;
            const cardId = document.getElementById("TagNo").value;
            const workId = document.getElementById("GongHao").value;
            const date = document.getElementById("rptDate").value;
            const timeFrame = document.getElementById("ddlTime").value;

            const validObj = {date, dept, name, cardId, timeFrame, workId}

            if (valid(validObj)) {
                let count = 1;
                for (let i = 0; i < database.length; i++) {
                    const item = database[i]
                    if (validObj.workId) break;
                    if (validObj.dept !== '43') break;
                    if (validObj.name && item.name !== validObj.name) continue;
                    if (validObj.cardId && item.cardId != validObj.cardId) continue;
                    const inp = formatTime(validObj.date)
                    const dbt = formatTime(item.intoTime)

                    // 待判断年月日
                    if (!(dbt[1] === 7 || dbt[1] === 8 || dbt[1] === 9 || dbt[1] === 10)) break;

                    if (inp[1] !== dbt[1] || inp[2] !== dbt[2]) continue;

                    item.id = count;
                    addNodes(item)
                    data.push(item)
                    count++;
                }
            }
        }

    </script>
</head>
<body>
<div id="Panel1">
    日期：<input name="rptDate" type="text" id="rptDate" style="width:70px;">
    <span id="RegularExpressionValidator2" style="color:Red;display:none;">日期错误</span>
    <img src="../../img/layout/cal.gif" id="f_trigger_c" title="选择日期">
    部门：<select name="dpBMList" id="dpBMList">
    <option value="0">--全矿--</option>
    <option value="24">机电战线</option>
    <option value="25">机电一队</option>
    <option value="26">机电二队</option>
    <option value="27">机电三队</option>
    <option value="28">机电修配厂</option>
    <option value="29">轨道运输队</option>
    <option value="30">开掘战线</option>
    <option value="31">掘进一队</option>
    <option value="33">掘进三队</option>
    <option value="36">通安战线</option>
    <option value="37">经营战线</option>
    <option value="40">通风队</option>
    <option value="41">采煤战线</option>
    <option selected="selected" value="43">综采准备队</option>
    <option value="44">综采二队</option>
    <option value="48">通风区</option>
    <option value="49">放炮队</option>
    <option value="50">开拓区</option>
    <option value="51">开拓队</option>
    <option value="54">机电运输区</option>
    <option value="55">煤质装运站</option>
    <option value="57">开拓工厂</option>
    <option value="58">维修队</option>
    <option value="60">采煤区</option>
    <option value="61">地质测量队</option>
    <option value="62">物管站</option>
    <option value="66">机电五队</option>
    <option value="67">带班领导</option>
    <option value="69">综机工厂</option>
    <option value="70">检查领导</option>
    <option value="73">综采三队</option>
    <option value="75">防突队</option>
    <option value="76">北山工区</option>
    <option value="78">支护科</option>
    <option value="80">调度室</option>
    <option value="81">企管科</option>
    <option value="83">防突区</option>
    <option value="97">安装回收队</option>
    <option value="103">天力公司打钻队</option>
    <option value="104">离职矿领导</option>
    <option value="105">重点办</option>
    <option value="106">建井三处</option>
    <option value="107">开拓一分队</option>
    <option value="108">安全管理中心</option>
    <option value="110">综合队</option>
    <option value="111">掘进二队</option>
    <option value="112">综采一队</option>
    <option value="113">综合一分队</option>
    <option value="114">综合二分队</option>
    <option value="115">借灯用卡</option>
    <option value="116">开拓二分队</option>
    <option value="117">建工集团</option>
    <option value="118">矿建公司安装处</option>
    <option value="119">机关</option>
    <option value="120">信息办</option>

</select>
    姓名：<input name="PeopleName" type="text" id="PeopleName" style="width:50px;">
    卡号：<input name="TagNo"
                type="text"
                id="TagNo"
                style="width:50px;">
    工号：<input name="GongHao" type="text" id="GongHao" style="width:50px;">
    &nbsp;<br>
    时间：<select name="ddlTime" id="ddlTime">
    <option selected="selected" value="所有时间">所有时间</option>
    <option value="&gt;">大于</option>
    <option value="&lt;">小于</option>
    <option value="&gt;=">大于等于</option>
    <option value="&lt;=">小于等于</option>
    <option value="&gt;=,&lt;=">&gt;=,&lt;=</option>

</select>(分钟)

    <input value=" 查 找 " onclick="getData()" name="Search" type="submit" id="Search" class="button"
           onmouseover="onButton(this);" onmouseout="offButton(this);">
    <input value=" 打 印 " onclick="alert('暂无权限')" name="Print" type="submit" id="Print" class="button"
           onmouseout="offButton(this);" onmouseover="onButton(this);">
    <span id="rf1" style="color:Red;display:none;">日期、时间不能为空</span>


    <div>
        <table class="Grid" cellspacing="0" rules="all" border="1" id="dbGrid_People"
               style="border-style:Dotted;width:100%;border-collapse:collapse;">
            <thead>
            <tr style="white-space:nowrap;">
                <th scope="col" style="width:40px;">序号</th>
                <th scope="col"><a href="#">卡号</a></th>
                <th scope="col"><a href="#">工号</a></th>
                <th scope="col"><a href="#">姓名</a></th>
                <th scope="col"><a href="#">部门</a></th>
                <th scope="col">
                    <a href="#" onclick="dataSort('intoTime')" onmouseover="changeArrow('arrow1');"
                       onmouseout="changeArrow('arrow1');">
                        入井时间
                        <span id="arrow1" style="margin-left: 2px;display:none;">↓</span>
                    </a>
                </th>
                <th scope="col">
                    <a href="#" onclick="dataSort('outTime')" onmouseover="changeArrow('arrow2');"
                       onmouseout="changeArrow('arrow2');">
                        升井时间
                        <span id="arrow2" style="margin-left: 2px;display:none;">↓</span>
                    </a>
                </th>
                <th scope="col">
                    <a href="#" onclick="dataSort('shift')" onmouseover="changeArrow('arrow3');"
                       onmouseout="changeArrow('arrow3');">
                        班次
                        <span id="arrow3" style="margin-left: 2px;display:none;">↓</span>
                    </a>
                </th>
                <th scope="col">
                    <a href="#" onclick="dataSort('stayTime')" onmouseover="changeArrow('arrow4');"
                       onmouseout="changeArrow('arrow4');">
                        停留时间
                        <span id="arrow4" style="margin-left: 2px;display:none;">↓</span>
                    </a>
                </th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script type="text/javascript">
        Calendar.setup({
            inputField: "rptDate",     // id of the input field
            ifFormat: "%Y/%m/%d",      // format of the input field
            button: "f_trigger_c",  // trigger for the calendar (button ID)
            singleClick: true
        });
    </script>
</div>

</body>
</html>
